<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Job Applications</title>
    <meta charset="UTF-8"/>

    <!-- Bootstrap CSS (CDN) -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
    />
</head>
<body class="bg-light">
<div th:replace="fragments/navbar :: navbar"></div>


<div class="container py-4">

    <h2 class="mb-4">Job Applications</h2>

    <!-- Filter Form -->
    <form method="get" th:action="@{/applications}" class="row g-2 align-items-end mb-3">
        <div class="col-md-3">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
                <option value="">All Status</option>
                <option th:each="s : ${statusValues}"
                        th:value="${s}"
                        th:text="${s}"
                        th:selected="${s} == ${selectedStatus}">
                </option>
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label">Company</label>
            <input type="text"
                   name="company"
                   class="form-control"
                   placeholder="Company name"
                   th:value="${company}"/>
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>

        <div class="col-md-3 text-md-end mt-2 mt-md-0">
            <a th:href="@{/applications/new}" class="btn btn-success">
                + Add New Application
            </a>
        </div>
    </form>

    <!-- Table -->
    <div class="card">
        <div class="card-body p-0">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th>Company</th>
                    <th>Position</th>
                    <th>Status</th>
                    <th>Application Date</th>
                    <th class="text-end">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="app : ${applications.content}">
                    <td th:text="${app.companyName}"></td>
                    <td th:text="${app.position}"></td>
                    <td th:text="${app.status}"></td>
                    <td th:text="${app.applicationDate}"></td>

                    <td class="text-end">

                        <!-- View & Edit -->
                        <a th:href="@{|/applications/${app.id}|}" class="btn btn-sm btn-outline-secondary">
                            View
                        </a>
                        <a th:href="@{|/applications/${app.id}/edit|}" class="btn btn-sm btn-outline-primary ms-1">
                            Edit
                        </a>

                        <!-- Status update -->
                        <form th:action="@{|/applications/${app.id}/status|}"
                              method="post"
                              class="d-inline-block ms-1">
                            <select name="status" class="form-select form-select-sm d-inline-block w-auto">
                                <option th:each="s : ${statusValues}"
                                        th:value="${s}"
                                        th:text="${s}"
                                        th:selected="${s} == ${app.status}">
                                </option>
                            </select>
                            <button type="submit" class="btn btn-sm btn-outline-success mt-1">
                                Update
                            </button>
                        </form>

                        <!-- Delete -->
                        <form th:action="@{|/applications/${app.id}/delete|}"
                              method="post"
                              class="d-inline-block ms-1"
                              onsubmit="return confirm('Are you sure you want to delete this application?')">
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                Delete
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <nav class="mt-3" th:if="${totalPages > 1}">
        <ul class="pagination mb-0">

            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/applications(page=${currentPage - 1}, status=${selectedStatus}, company=${company})}">
                    Previous
                </a>
            </li>

            <li class="page-item disabled">
                <span class="page-link">
                    Page [[${currentPage + 1}]] / [[${totalPages}]]
                </span>
            </li>

            <li class="page-item"
                th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/applications(page=${currentPage + 1}, status=${selectedStatus}, company=${company})}">
                    Next
                </a>
            </li>
        </ul>
    </nav>

</div>

</body>
</html>
